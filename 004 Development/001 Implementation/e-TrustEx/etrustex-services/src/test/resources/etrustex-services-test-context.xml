<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:p="springframework.org/schema/p" xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:cache="http://www.springframework.org/schema/cache"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd 
       http://www.springframework.org/schema/util 
       http://www.springframework.org/schema/util/spring-util.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/cache 
       http://www.springframework.org/schema/cache/spring-cache.xsd"
	default-autowire="byName">

	<context:annotation-config />

	<tx:annotation-driven />
	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="entityManagerFactory" />
	</bean>

	<cache:annotation-driven />
	<bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager">
		<property name="cacheManager">
			<ref local="ehcache" />
		</property>
	</bean>
	<bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" p:configLocation="classpath:ehcache.xml" />

	<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean">
		<property name="persistenceUnitName" value="etrustex-test" />
	</bean>


	<bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" />

	<bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />

	<bean id="eTrustExDS" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="com.mysql.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://localhost/etrustex" />
		<property name="username" value="trustex_user" />
		<property name="password" value="trustex_passw" />
	</bean>

	<bean id="metadataDAO" class="eu.europa.ec.cipa.etrustex.services.dao.MetadataDAO" />
	<bean id="xmlDAO" class="eu.europa.ec.cipa.etrustex.services.dao.XmlDAO" />
	<bean id="transactionDAO" class="eu.europa.ec.cipa.etrustex.services.dao.TransactionDAO" />
	<bean id="partyDAO" class="eu.europa.ec.cipa.etrustex.services.dao.PartyDAO" />
	<bean id="serviceEndpointDAO" class="eu.europa.ec.cipa.etrustex.services.dao.ServiceEndpointDao" />
	<bean id="interchangeAgreementDAO" class="eu.europa.ec.cipa.etrustex.services.dao.InterchangeAgreementDAO" />
	<bean id="partyAgreementDAO" class="eu.europa.ec.cipa.etrustex.services.dao.PartyAgreementDAO" />
	<bean id="credentialsDAO" class="eu.europa.ec.cipa.etrustex.services.dao.CredentialsDAO" />
	<bean id="messageResponseCodeDAO" class="eu.europa.ec.cipa.etrustex.services.dao.MessageResponseCodeDAO" />
	<bean id="endpointDAO" class="eu.europa.ec.cipa.etrustex.services.dao.EndpointDAO" />
	<bean id="decDAO" class="eu.europa.ec.cipa.etrustex.services.dao.DataExtractionConfigDAO" />
	<bean id="queryResultDAO" class="eu.europa.ec.cipa.etrustex.services.dao.QueryResultDAO" />

	<bean id="messageBinaryDAO" class="eu.europa.ec.cipa.etrustex.services.dao.MessageBinaryDAO">
		<property name="insertMessageBinaryQuery">
			<value>
				INSERT INTO
				ETR_TB_MESSAGE_BINARY(MSG_BIN_TYPE,MSG_BIN_MIME,MSG_BIN_MSG_ID,CRE_DT,CRE_ID,MOD_DT,MOD_ID,MSG_BIN_FILE)
				VALUES(?,?,?,?,?,?,?,?)
			</value>
		</property>
		<property name="linkBinaryQuery">
			<value>
				UPDATE
				ETR_TB_MESSAGE_BINARY set MSG_BIN_MSG_ID= ? where MSG_BIN_ID=?
			</value>
		</property>
		<property name="retrieveBinaryQuery">
			<value>
				SELECT MSG_BIN_FILE FROM ETR_TB_MESSAGE_BINARY where MSG_BIN_MSG_ID=? and MSG_BIN_TYPE=?
			</value>
		</property>

		<property name="streamBinaryQuery">
			<value>
				update ETR_TB_MESSAGE_BINARY set MSG_BIN_FILE= ? where MSG_BIN_ID=?
			</value>
		</property>
		<property name="retrieveBinaryStreamQuery">
			<value>
				SELECT MSG_BIN_FILE FROM ETR_TB_MESSAGE_BINARY where MSG_BIN_ID=?
			</value>
		</property>


		<property name="encryptionKey">
			<value>XbwXQaT+LcFUXYX3Cnt6tQ8n8QKxcNRjpfZYQ9BGUdI=</value>
		</property>

		<property name="keySize">
			<value>128</value>
		</property>
	</bean>
	<bean id="messageDAO" class="eu.europa.ec.cipa.etrustex.services.dao.MessageDAO">
		<property name="insertMessageQuery">
			<value>
				INSERT INTO
				ETR_TB_MESSAGE(CRE_DT,CRE_ID,MOD_DT,MOD_ID,MSG_CORRELATION_ID,MSG_DOCUMENT_ID,MSG_STS_CD,MSG_AGR_ID,MSG_ISSUER_ID,MSG_TRANS_ID,MSG_RECEIPT_DT,MSG_ISSUE_DT,MSG_RECEIVER_ID,MSG_SENDER_ID,MSG_DOC_TYPE_CD,MSG_RETRIEVED_FL)
				VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
			</value>
		</property>
		<property name="selectMessageQuery">
			<value>
				SELECT MSG_ID FROM ETR_TB_MESSAGE where MSG_SENDER_ID=? and MSG_DOCUMENT_ID=? and MSG_TRANS_ID=?
			</value>
		</property>
	</bean>
	<bean id="roleDAO" class="eu.europa.ec.cipa.etrustex.services.dao.RoleDAO" />
	<bean id="userDAO" class="eu.europa.ec.cipa.etrustex.services.dao.admin.UserDAO" />
	<bean id="profileDAO" class="eu.europa.ec.cipa.etrustex.services.dao.ProfileDAO" />
	<bean id="businessDomainDAO" class="eu.europa.ec.cipa.etrustex.services.dao.BusinessDomainDAO" />
	<bean id="slaPolicyDAO" class="eu.europa.ec.cipa.etrustex.services.dao.SlaPolicyDAO" />

	<bean id="partyRoleDAO" class="eu.europa.ec.cipa.etrustex.services.dao.PartyRoleDao" />
	<bean id="userRoleDAO" class="eu.europa.ec.cipa.etrustex.services.dao.admin.UserRoleDAO" />
	<bean id="logDAO" class="eu.europa.ec.cipa.etrustex.services.dao.LogDAO" />


	<bean id="metadataService" class="eu.europa.ec.cipa.etrustex.services.MetadataService" />
	<bean id="stateMachineService" class="eu.europa.ec.cipa.etrustex.services.StateMachineService" />
	<bean id="xmlService" class="eu.europa.ec.cipa.etrustex.services.XmlService" />
	<bean id="interchangeAgreementService" class="eu.europa.ec.cipa.etrustex.services.InterchangeAgreementService" />
	<bean id="endpointService" class="eu.europa.ec.cipa.etrustex.services.EndpointService" />
	<bean id="logService" class="eu.europa.ec.cipa.etrustex.services.LogService" />

	<bean id="roleService" class="eu.europa.ec.cipa.etrustex.services.RoleService" />
	<bean id="userService" class="eu.europa.ec.cipa.etrustex.services.admin.UserService" />
	<bean id="partyService" class="eu.europa.ec.cipa.etrustex.services.PartyService" />
	<bean id="partyRoleService" class="eu.europa.ec.cipa.etrustex.services.PartyRoleService" />
	<bean id="partyAgreementService" class="eu.europa.ec.cipa.etrustex.services.PartyAgreementService" />
	<bean id="profileService" class="eu.europa.ec.cipa.etrustex.services.ProfileService" />
	<bean id="ciaLevelService" class="eu.europa.ec.cipa.etrustex.services.CIALevelService" />
	<bean id="businessDomainService" class="eu.europa.ec.cipa.etrustex.services.BusinessDomainService" />
	<bean id="queryService" class="eu.europa.ec.cipa.etrustex.services.QueryService">
		<property name="txDAO" ref="transactionDAO" />
		<property name="decDAO" ref="decDAO" />
		<property name="messageDAO" ref="messageDAO" />
		<property name="queryResultDAO" ref="queryResultDAO" />
	</bean>
	<!--<bean id="slaPolicyService" class="eu.europa.ec.cipa.etrustex.integration.task.SlaPolicyService" />-->

	<bean id="messageService" class="eu.europa.ec.cipa.etrustex.services.MessageService">
		<property name="messageDAO" ref="messageDAO" />
		<property name="messageBinaryDAO" ref="messageBinaryDAO" />
		<property name="localUsefilestore">
			<value type="java.lang.Boolean">true</value>
		</property>
		<property name="localFileStorePath" value="e:/data" />
	</bean>

	<context:component-scan base-package="eu.europa.ec.cipa.etrustex.services.dao" />
	<context:component-scan base-package="eu.europa.ec.cipa.etrustex.domain" />

	<bean id="encryptionService" class="eu.europa.ec.cipa.etrustex.services.util.EncryptionService"/>
	<bean id="authorisationService" class="eu.europa.ec.cipa.etrustex.services.AuthorisationService"/>
	<bean id="transactionService" class="eu.europa.ec.cipa.etrustex.services.TransactionService"/>
	<!--<bean id="slaPolicyHelper" class="eu.europa.ec.cipa.etrustex.integration.task.SlaPolicyHelper"/>-->

</beans>
