<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:cache="http://www.springframework.org/schema/cache" xmlns:p="springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd 
       http://www.springframework.org/schema/util 
       http://www.springframework.org/schema/util/spring-util.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/cache 
       http://www.springframework.org/schema/cache/spring-cache.xsd"
	default-autowire="byName">

	<import resource="etrustex-data-access-context.xml" />


	<context:annotation-config />
	<context:component-scan base-package="eu.europa.ec.cipa.etrustex.services" />	<!-- Configure Transaction Support - Access the JTA transaction manager -->

	<!-- <bean id="transactionManager" -->
	<!-- class="org.springframework.transaction.jta.JtaTransactionManager"> -->
	<!-- <property name="transactionManagerName" value="java:/TransactionManager" 
		/> -->

	<!-- </bean> -->

	<!-- <tx:annotation-driven transaction-manager="transactionManager" /> -->

	<!-- <bean id="txManager" -->
	<!-- class="org.springframework.transaction.jta.JtaTransactionManager"> -->
	<!-- <property name="transactionManagerName" value="java:/TransactionManager" 
		/> -->

	<!-- </bean> -->
<!--  JBOSS -->
	<tx:annotation-driven />
	<tx:jta-transaction-manager  />
	
<!-- 	<bean id="txManager" class="org.springframework.transaction.jta.WebLogicJtaTransactionManager"> -->
<!-- 		<property name="transactionManagerName" value="javax.transaction.TransactionManager" /> -->
<!-- 	</bean> -->
<!-- 	<tx:annotation-driven transaction-manager="txManager" proxy-target-class="true" order="1"/> -->
	
	<cache:annotation-driven />

	<bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager">
		<property name="cacheManager" ref="ehcache"/>
	</bean>
	<bean id="ehcache"
		class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"
		p:configLocation="classpath:ehcache.xml" p:shared="true"/>
	<bean id="authorisationService"
		class="eu.europa.ec.cipa.etrustex.services.AuthorisationService">
	</bean>
	<bean id="metadataService" class="eu.europa.ec.cipa.etrustex.services.MetadataService"/>
	<bean id="messageService" class="eu.europa.ec.cipa.etrustex.services.MessageService">
		<property name="metadataService" ref="metadataService"/>
		<property name="messageDAO" ref="messageDAO" />
		<property name="messageBinaryDAO" ref="messageBinaryDAO" />
		
		<property name="localUsefilestore">
			<value type="java.lang.Boolean">#{ 'true' eq '${etrustex.localUsefilestore}' ? 'true' : 'false' }</value>
		</property>
			
		<property name="usefilestoreMetadata">
			<value type="java.lang.Boolean">#{ 'false' eq '${etrustex.usefilestoreMetadata}' ? 'false' : 'true' }</value>
		</property>	
		
		<property name="localFileStorePath" value="${etrustex.localFileStorePath}" />		
		
		
	</bean>
	<bean id="stateMachineService" class="eu.europa.ec.cipa.etrustex.services.StateMachineService"/>
	<bean id="xmlService" class="eu.europa.ec.cipa.etrustex.services.XmlService"/>
	<bean id="interchangeAgreementService" class="eu.europa.ec.cipa.etrustex.services.InterchangeAgreementService"/>
	<bean id="endpointService" class="eu.europa.ec.cipa.etrustex.services.EndpointService"/>
	
	<bean id="roleService" class="eu.europa.ec.cipa.etrustex.services.RoleService"/>
	<bean id="userService" class="eu.europa.ec.cipa.etrustex.services.admin.UserService"/>
	<bean id="partyService" class="eu.europa.ec.cipa.etrustex.services.PartyService"/>
	<bean id="partyRoleService" class="eu.europa.ec.cipa.etrustex.services.PartyRoleService"/>
	<bean id="partyAgreementService" class="eu.europa.ec.cipa.etrustex.services.PartyAgreementService"/>
	<bean id="profileService" class="eu.europa.ec.cipa.etrustex.services.ProfileService"/>
	<bean id="ciaLevelService" class="eu.europa.ec.cipa.etrustex.services.CIALevelService"/>
	<bean id="businessDomainService" class="eu.europa.ec.cipa.etrustex.services.BusinessDomainService"/>
	<bean id="queryService" class="eu.europa.ec.cipa.etrustex.services.QueryService">
		<property name="txDAO" ref="transactionDAO" />
		<property name="decDAO" ref="decDAO" />
		<property name="messageDAO" ref="messageDAO" />
		<property name="queryResultDAO" ref="queryResultDAO" />
	</bean>
	<bean id="slaPolicyService" class="eu.europa.ec.cipa.etrustex.integration.task.SlaPolicyService"/>
	<bean id="monitoringService" class="eu.europa.ec.cipa.etrustex.services.MonitoringService"/>
	<bean id="transactionService" class="eu.europa.ec.cipa.etrustex.services.TransactionService"/>
	<bean id="encryptionService" class="eu.europa.ec.cipa.etrustex.services.util.EncryptionService">
	    <property name="addAlgorithmPrefix">
	        <value type="java.lang.Boolean">#{ 'true' eq '${user.password.addAlgorithmPrefix}' ? 'true' : 'false' }</value>
	    </property>
	</bean>
	
</beans>
